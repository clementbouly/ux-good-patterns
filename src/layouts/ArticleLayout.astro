---
import PageLayout from "./PageLayout.astro";
import { ArrowLeft } from "lucide-react";
import { ShareButton } from "@/components/ShareButton";
import { articles } from "@/articles";
import { formatDate } from "@/lib/dateUtils";
import { getLangFromLocale, useTranslations, type Lang } from "@/i18n";
import { getRelativeLocaleUrl } from "astro:i18n";

interface Props {
  frontmatter: {
    title: string;
    description?: string;
  };
}

const { frontmatter } = Astro.props;
const currentUrl = new URL(Astro.url.pathname, Astro.site).toString();

// Get language
const lang = getLangFromLocale(Astro.currentLocale) as Lang;
const t = useTranslations(lang);

// Get article slug from URL path (handle both /article/ and /fr/article/)
const slug = Astro.url.pathname.replace(/^\/(fr\/)?article\//, "").replace(/\/$/, "");
const article = articles.find((a) => a.slug === slug);

// Get localized articles URL
const articlesUrl = getRelativeLocaleUrl(lang, "/articles");
---

<PageLayout title={`${frontmatter.title} | The Good, The Bad and The UX`} description={frontmatter.description}>
  <div class="mx-auto max-w-5xl">
    <div class="mb-6 flex items-center justify-between">
      <a
        href={articlesUrl}
        class="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
      >
        <ArrowLeft className="h-4 w-4" />
        {t("articles.backToArticles")}
      </a>
      <ShareButton client:load url={currentUrl} />
    </div>

    <article class="prose prose-neutral max-w-none dark:prose-invert prose-headings:scroll-mt-20 prose-h1:text-3xl prose-h2:text-2xl prose-h2:mt-10 prose-h3:text-xl prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-hr:hidden rounded-lg border bg-card p-6 md:p-8">
      {article && (
        <p class="text-sm text-muted-foreground not-prose mb-4">{formatDate(article.createdAt)}</p>
      )}
      <slot />
    </article>
  </div>
</PageLayout>
